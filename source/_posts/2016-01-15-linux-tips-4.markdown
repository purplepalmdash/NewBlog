---
layout: post
title: "Linux Tips(4)"
date: 2016-01-15 18:37:03 +0800
comments: true
categories: Linux
---
### 1. Run ansible commands
Run commands in all hosts:    

```
# ansible all -i inventory.ini -m command -u root --args "uptime"
```

### 2. mesos introduction
[http://www.infoq.com/cn/articles/analyse-mesos-part-02](http://www.infoq.com/cn/articles/analyse-mesos-part-02)    

### 3. Limit ansible run hosts

```
# ansible-playbook -i inventory_mesos_cluster changehostname.yml -u root -k
-vvvv --list-hosts

playbook: changehostname.yml

  play #1 (master1): host count=1
    10.47.58.31

#  ansible-playbook -i
inventory_mesos_cluster changehostname.yml -u root -k -vvvv --limit="master1"

```

### 4. Configure the dhcp configuration of libvirtd
First edit the net configuration:    

```
# virsh net-edit xxxxx
```

![/images/2016_01_16_20_23_08_715x270.jpg](/images/2016_01_16_20_23_08_715x270.jpg)    
### 5. Copy items into clipboard in vim
Hit `Ctrl+v` to visual model, then select the items you want to copy, after select
them, click `"*y` will copy whatever you selected into your clipbard.     

Copy from clipboard---- simply hit `p` in command mode.    

### 6. mesos.cli
When you meet `no module named mesos`, install it via pip:    

```
$ pip install mesos.cli
```

### 7. Startdict In Command Line

```
$ sudo apt-get install -y sdcv
$ wget
https://web.archive.org/web/20140917131745/http://abloz.com/huzheng/stardict-dic/dict.org/stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2
$ sudo mkdir -p /usr/share/stardict/dic/
$ sudo tar xjvf stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2 -C /usr/share/stardict/dic 

```

### 8. Golden Dict
Golden Dict.   

### 9. Latest Info On OpenStack
[https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&mid=404253985&idx=1&sn=0d6c544dfb129e35bde7d19a0de8887b&scene=1&srcid=01267Etq7arAdYaFqbUG5BNa&pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd](https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&mid=404253985&idx=1&sn=0d6c544dfb129e35bde7d19a0de8887b&scene=1&srcid=01267Etq7arAdYaFqbUG5BNa&pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd)    

### 10. Quickly Configure vagrant machine
Via following you could get outside world:     

```
ip route del default gw 10.0.2.2 dev enp0s3
ip a del 192.168.10.199/24 dev enp0s8
ip a add 192.168.10.199/16 dev enp0s8
ip route add default via 192.168.0.79 dev enp0s8
```

### 11. Change the default gateway On CentOS 7
Default gateway should go here:    

```
$ cat /etc/sysconfig/network
# Created by anaconda
GATEWAY=192.168.0.79
```

And remove the origin default gateway by adding following definitions :    

```
$ cat /etc/sysconfig/network-scripts/ifcfg-enp0s3 
# Generated by dracut initrd
NAME="enp0s3"
DEVICE="enp0s3"
BOOTPROTO=dhcp
# This one is not the default gw
DEFROUTE=no
# Do not override the dns
PEERDNS=no
```
Thus the default gateway won't go from enp0s3, but from enp0s8, won't configure the dns
address to 10.0.x.x.    

### 12. On VPNs

```
http://linsir.org/post/how_to_install_IPSec_IKEV2_base_on_strongswan_with_CentOS7
https://quericy.me/blog/512
https://quericy.me/blog/699
http://lifehacker.io/post/108814979111/%E5%9C%A8%E6%90%AC%E7%93%A6%E5%B7%A5%E7%9A%84centos7%E4%B8%8B%E6%90%AD%E5%BB%BAstrongswan%E5%AE%9E%E7%8E%B0%E5%9C%A8ios%E4%B8%8A%E6%8C%89%E9%9C%80%E8%BF%9E%E6%8E%A5vpn
https://raymii.org/s/tutorials/IPSEC_vpn_with_CentOS_7.html
https://linux.cn/article-5938-weibo.html
```

MMC snap-in:    
[https://technet.microsoft.com/en-us/library/cc722035.aspx](https://technet.microsoft.com/en-us/library/cc722035.aspx)    

### 13. Use iptables On CentOS7
Use  following steps for disable firewalld and use iptables.    

```
$ systemctl stop firewalld
$ systemctl mask firewalld
$ yum install iptables-services
$ systemctl enable iptables
$ systemctl start iptables

```

### 14. Quickly Goes kernel configuration
When you want to configure the newer kernel source tree using your old kernel
configuration, simply do following:    

```
# yes "" | make oldconfig
```

### 15. iptables problem
After installing the newest kernel, I cannot use iptables, showing ` can't initialize iptables : table does not exist`.       

Solution: compile the modules again, select nat.     

![/images/2016_01_28_16_05_52_496x361.jpg](/images/2016_01_28_16_05_52_496x361.jpg)    

Selecting from:     
Networking Support    
Network Options     
Network packet filtering framework(Netfilter)    
IP: Netfilter Configuration    


Then you should `make modules_install` under your kernel source building directory.     

### 16. DistCC For Building Kernel DEB
On configurating distcc:    
[http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html](http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html)    

On building Linux kernel deb files:    

[http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/](http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/)     

And:    

[https://help.ubuntu.com/community/Kernel/Compile](https://help.ubuntu.com/community/Kernel/Compile)     

Actual command:    

```
$ time sudo make -j12 CC=distcc
$ sudo MAKEFLAGS="CC=distcc" make-kpkg --rootcmd fakeroot --initrd --append-to-version=-suspend2 kernel-image kernel-headers kernel-source -j16
```

Really takes long time for building the kernel out, but the iptables won't works.    


### 17. dmenu On Ubuntu
dmenu is in the package of suckless-tools.    

```
$ sudo apt-get install suckless-tools
```

### 18. Virtio-GPU How-to
[https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/](https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/)    

### 20. Use Latest Dev Kernel On Fedora
Refers to
[http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories](http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories)     

```
$ curl -s https://repos.fedorapeople.org/repos/thl/kernel-vanilla.repo | sudo tee /etc/yum.repos.d/kernel-vanilla.repo
$ sudo dnf --enablerepo=kernel-vanilla-mainline update
```

Fall back to the stable one:    

```
$ sudo dnf --enablerepo=kernel-vanilla-stable update
```

### 21. Install grub on usb disk/ArchLinux

```
# chattr -i /boot/grub/i386-pc/core.img 
# grub-install --target=i386-pc --recheck --debug --force /dev/sdb
# chattr +i /boot/grub/i386-pc/core.img 
```
### 22. fcitx-gtk3
Since now firefox using gtk3, so if you want to input chinese in firefox, simply install `fcitx-gtk3` then you get fcitx working.     

### 23. Polkit And Virt-manager
Problem:    

```
$ virsh -c qemu:///system
error: failed to connect to the hypervisor
error: authentication failed: no agent is available to authenticate
```

Add the configuration for the polkit and restart the service:    

```
$ sudo vim /etc/polkit-1/rules.d/49-org.libvirt.unix.manager.rules
polkit.addRule(function(action, subject) {
    if (action.id == "org.libvirt.unix.manage" &&
        subject.isInGroup("kvm")) {
            return polkit.Result.YES;
        }
});
```

And also you have to add your current user into the group of `kvm`:    

```
$ sudo usermod -a -G kvm <user name>
```

Restar the polkit service via:    

```
$ sudo systemctl restart polkit.service
```

### 24. Running tasks in byobu
[http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen](http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen)    

### 25. GPU Pass-Through
[http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/](http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/)    

### 26. yaourt build error
Reason: gpg checking error, solution is:    

```
$ proxychains4 gpg --recv-key  79BE3E4300411886
```

### 27. libvirtd and polkit
Bypass the password prompt:    

[https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt](https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt)     


### 28. virgl repository
[https://www.kraxel.org/repos/](https://www.kraxel.org/repos/)    

### 29. pass-through howto
[http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html](http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html)     

### 30. Control the USB port power
[http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux](http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux)     

### 31. On how to reverse usb device
[http://www.linuxjournal.com/article/7353?page=0,0](http://www.linuxjournal.com/article/7353?page=0,0)    
[https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/](https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/)    

### 32. Set/Unset keyboard LED
Turn on/off the Scroll LED of the keyboard(USB):    

```
xset led 3
xset -led 3
```

### 33. USB In a NutShell
[http://www.beyondlogic.org/usbnutshell/usb1.shtml](http://www.beyondlogic.org/usbnutshell/usb1.shtml)    

### 34. Arduino USB Tutorial
[http://codeandlife.com/2012/01/22/avr-attiny-usb-tutorial-part-1/](http://codeandlife.com/2012/01/22/avr-attiny-usb-tutorial-part-1/)     

### 35. Auduino USB Project
[https://www.obdev.at/products/vusb/projects.html](https://www.obdev.at/products/vusb/projects.html)    

### 36. Detecting mouse events
Using evtest for detecting mouse events:    

```
$ sudo apt-get install evtest
$ sudo evtest
```

### 37. SteelSeries Mouse (RAW) DEMO

[https://www.youtube.com/watch?v=yvvybR6oyvs](https://www.youtube.com/watch?v=yvvybR6oyvs)    

### 38. USB Device Driver
[http://blog.chinaunix.net/uid-20587912-id-2984380.html](http://blog.chinaunix.net/uid-20587912-id-2984380.html)    

[http://www.wzona.info/2012/10/usb-duomenu-perdavimas-atmega.html](http://www.wzona.info/2012/10/usb-duomenu-perdavimas-atmega.html)   


### 39. Reverse usb device driver
[http://phoeagon.byethost15.com/2012/05/05/%e7%bb%99%e6%9d%82%e7%89%8c%e5%b9%bb%e7%81%af%e7%89%87usb%e9%81%a5%e6%8e%a7%e5%86%99linux%e9%a9%b1%e5%8a%a8-%e4%b8%8a/](http://phoeagon.byethost15.com/2012/05/05/%e7%bb%99%e6%9d%82%e7%89%8c%e5%b9%bb%e7%81%af%e7%89%87usb%e9%81%a5%e6%8e%a7%e5%86%99linux%e9%a9%b1%e5%8a%a8-%e4%b8%8a/)    

[http://www.phoronix.com/scan.php?page=news_item&px=MTEzODU](http://www.phoronix.com/scan.php?page=news_item&px=MTEzODU)    


[https://bbs.archlinux.org/viewtopic.php?id=187995](https://bbs.archlinux.org/viewtopic.php?id=187995)    

[https://www.youtube.com/watch?v=GdvmsWnZkyc](https://www.youtube.com/watch?v=GdvmsWnZkyc)    

[https://learn.adafruit.com/hacking-the-kinect/more-kinect-information](https://learn.adafruit.com/hacking-the-kinect/more-kinect-information)   

[https://www.linuxvoice.com/drive-it-yourself-usb-car-6/](https://www.linuxvoice.com/drive-it-yourself-usb-car-6/)    

Total Phase USB:    

[http://www.totalphase.com/products/beagle-usb12/](http://www.totalphase.com/products/beagle-usb12/)    

[https://github.com/dmage/co2mon](https://github.com/dmage/co2mon)    

### 40. v-usb tutorial
[http://www.workinprogress.ca/v-usb-tutorial-software-only-usb-for-mega-tiny/](http://www.workinprogress.ca/v-usb-tutorial-software-only-usb-for-mega-tiny/)    

### 41. v-usb and Arduino
[https://www.hackster.io/rayburne/arduino-to-excel-using-v-usb-cbf701](https://www.hackster.io/rayburne/arduino-to-excel-using-v-usb-cbf701)   

[http://www.geek-workshop.com/forum.php?mod=viewthread&tid=8578&highlight=v-usb](http://www.geek-workshop.com/forum.php?mod=viewthread&tid=8578&highlight=v-usb)    

[http://coopermaa2nd.blogspot.tw/2011/10/v-usb-examples-for-arduino.html](http://coopermaa2nd.blogspot.tw/2011/10/v-usb-examples-for-arduino.html)    

[http://www.geek-workshop.com/thread-1137-1-1.html](http://www.geek-workshop.com/thread-1137-1-1.html)    

[http://www.geek-workshop.com/forum.php?mod=viewthread&tid=15114&highlight=v-usb](http://www.geek-workshop.com/forum.php?mod=viewthread&tid=15114&highlight=v-usb)    

### 42.Set Timezone of the ArchLinux
Change from UTC to Asia/Shanghai:    

```
$ timedatectl set-timezone Asia/Shanghai
```

### 43. Empty all of the bash history
Empty the bash history via:    

```
$ rm -f ~/.bash_history
```

### 44. Specify qemu-binary in Packer.io
Edit the json files:    

```
"builders":
[
{
"type": "qemu",
"qemu_binary" : "/usr/libexec/qemu-kvm.sh",
```

### 45. apprmor.d

```
I modified /etc/apparmor.d/abstractions/libvirt-qemu to include the
backing store directory
```

### 46. Recover UEFI bootloader
After remove the mainline linux kernel, the archlinux is using the default kernel, but
the UEFI bootloader didn't notice this, following are the steps for recover the UEFI
bootloader.     

```
grub-install --target=x86_64-efi --efi-directory=/boot/EFI   --bootloader-id=arch_grub --recheck
cat ./EFI/loader/entries/arch.conf
```
Change the items into `initramfs-linux`.     

If you cannot login to the system, you could start the machine via USB disk or
installation media, using `arch-chroot /mnt/ /bin/bash` for login to the chroot system,
then do the above operations.   

### 47. bonding
[http://sanswers.com/tube/wotC5GZ2FV0/bonding-eth0-and-wlan0-on-arch-linux](http://sanswers.com/tube/wotC5GZ2FV0/bonding-eth0-and-wlan0-on-arch-linux)    

### 48. Fix currpted zsh history 
history corrupted.    

```
$ mv .zsh_history .zsh_history_bad
$ strings .zsh_history_bad > .zsh_history
$ fc -R .zsh_history
```

### 49. pulp
Using pulp for managing the repositories of RPM/Docker, etc.    

### 50. Chromium flash
Install chromium-pepper-flash in aur.    

### 51. Install xfce4 on CentOS
Install xfce in epel repository via:    

```
# yum --enablerepo=epel -y groups install "Xfce" 
```

### 52. LED controller
[http://www.seeedstudio.com/recipe/402-smart-power-outlet.html](http://www.seeedstudio.com/recipe/402-smart-power-outlet.html)    

### 53. Build php envs
[https://medium.com/dev-tricks/apache-and-php-on-docker-44faef716150#.c8bguolj0](https://medium.com/dev-tricks/apache-and-php-on-docker-44faef716150#.c8bguolj0)   

### 54. handle docker changes
[http://dbaron.org/linux/handle-dock-change.py](http://dbaron.org/linux/handle-dock-change.py)    

### 55. python detection of usb storage
[https://linuxmeerkat.wordpress.com/2014/11/12/python-detection-of-usb-storage-device/](https://linuxmeerkat.wordpress.com/2014/11/12/python-detection-of-usb-storage-device/)    
d-feet for debugging of dbus..       

### 56. libmtp related
Install `gvfp-mtp`, then you could get your nautillus have the mtp device
support.     

Using `mtp-detect` for detecting the equipments and `mtp-connect` for
connecting the device.    

### 57. Virtualbox Driver Issue
After upgrading the system, the virtualbox won't start the machine, this is because we
didn't install the kernel header, thus the dkms won't be run after system upgrading.
Install kernel-headers:    

```
$ sudo pacman -S linux-headers
$ sudo /sbin/rcvboxdrv setup
``` 

### 58. Creation tools
[https://linux.cn/article-7072-1.html](https://linux.cn/article-7072-1.html)    

### 59. rvm reinstall issue
openssl load error:    

```
$ rvm pkg install openssl
$ rvm install 2.2.1  --with-openssl-dir=$HOME/.rvm/usr
$ proxychains4 gem update bundler
```
Then you can continue to use your octopress.    

### 60 Install go on ArchLinux

```
$ sudo pacman -S go
$ mkdir ~/go
$ vim ~/.zshrc
export GOPATH=~/go
export PATH=$PATH:~/go/bin
```

### 61. Packer Development Version
The steps on building packer on Ubuntu:    

```
$ sudo add-apt-repository ppa:ubuntu-lxc/lxd-stable
$ sudo apt-get update
$ sudo apt-get install golang
$ mkdir -p $HOME/Documents/golang
$ export GOPATH=$HOME/Documents/golang
$ export GO15VENDOREXPERIMENT=1
$ export PATH=$PATH:$GOPATH/bin
$ go get github.com/mitchellh/packer
$ cd $GOPATH/src/github.com/mitchellh/packer
$ sudo chown -R dash /home/dash/
$ make
```
bitnami

### 62. Install add-apt-repository command

add-apt-repository missing:    

```
$ sudo apt-get install software-properties-common
```
### 63. git checkout specified tags
For checkout specified tag:    

```
$ git tag -l
.....
.....
xxyy
$ git checkout tags/xxyy -b xxyy_local
```

### 64. Nested kvm On ArchLinux
Enable the nested kvm for ArchLinux via following steps:     

```
➜  ~ systool -m kvm_intel -v | grep nested
    nested              = "N"
➜  ~ modprobe -r kvm_intel
modprobe: ERROR: could not remove 'kvm_intel': Operation not permitted
➜  ~ sudo modprobe -r kvm_intel
➜  ~ sudo modprobe kvm_intel nested=1
➜  ~ sudo vim /etc/modprobe.d/modprobe.conf
options kvm_intel nested=1
➜  ~ systool -m kvm_intel -v | grep nested
    nested              = "Y"
```

### 65. Failed to build rubygem
Issue:    

```
Unable to install gem - Failed to build gem native extension - cannot load
such file — mkmf (LoadError)
```

Solved by: ` sudo apt-get install -y ruby-dev`.      

### 66. xe-tools location
Loation for finding xe-tools:    

```
# pwd
/opt/xensource/packages/iso
# ls
XenCenter.iso  xs-tools-6.5.0-20001.iso  xs-tools-6.5.0.iso
```

### 67. Qemu Tunnel Types
[http://linuxsimba.com/qemu-tunnel-types/](http://linuxsimba.com/qemu-tunnel-types/)    

### 68. zsh history
Error message is `zsh: corrupt history file /home/myusername/.zsh_history`.    

Solved by:    

```
➜  ~ mv .zsh_history .zsh_history_bad
➜  ~ strings .zsh_history_bad > .zsh_history
➜  ~ fc -R .zsh_history
```

### 69. virsh priviledge In Ubuntu
When met following issue, solved via add current user to `libvirtd` and `kvm`, relogin
again then issue would be solved:    

```
Error while connecting to libvirt: Error making a connection to libvirt URI
qemu:///system?no_verify=1&keyfile=/home/dash/.ssh/id_rsa:
Call to virConnectOpen failed: Failed to connect socket to
'/var/run/libvirt/libvirt-sock': Permission denied
```

Solution :    

```
$ sudo usermod -a -G kvm dash
$ sudo usermod -a -G libvirtd dash
```

### 70. Vagrant ext vars
[http://stackoverflow.com/questions/23008367/ansible-with-vagrant-read-inventory-from-vagrantfile-extra-vars](http://stackoverflow.com/questions/23008367/ansible-with-vagrant-read-inventory-from-vagrantfile-extra-vars)    

### 71. rootpasswd in Kickstart
Formats, and to generate the encrypted format.    

```
rootpw "password here"
rootpw --iscrypted password_hash
$ openssl passwd -1 "password here"
```

### 72. On Vagrant Xenserver
To build Xenserver vagrant box in packer:    
[https://github.com/imduffy15/packer-xenserver](https://github.com/imduffy15/packer-xenserver)    

Possible usable vagrant box(For Xenserver):   
[https://vagrantcloud.com/duffy/boxes/xenserver](https://vagrantcloud.com/duffy/boxes/xenserver)     

Remote provisioning to a xenserver hypervisor:    
[http://serverfault.com/questions/631837/remote-automated-provisioning-to-a-xenserver-hypervisor](http://serverfault.com/questions/631837/remote-automated-provisioning-to-a-xenserver-hypervisor)    

Ansible and Xen:    
[http://sharknet.us/2013/12/13/276/](http://sharknet.us/2013/12/13/276/)    

Vagrant and XenServer:    
[https://github.com/jonludlam/vagrant-xenserver](https://github.com/jonludlam/vagrant-xenserver)    


### 73. Tips on Xenserver In Vagrant
Mac address:

```
# vim /etc/sysconfig/network-scripts/interface-rename-data/static-rules.conf
eth0:mac = "xxxxxxxxx"
# interface-rename --dry-run --reset-to-install
```
Then  you could reset all of your configuration into the initial status.    

### 74. oh-my-vagrant
[https://github.com/purpleidea/oh-my-vagrant](https://github.com/purpleidea/oh-my-vagrant)    
