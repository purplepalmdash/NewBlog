---
layout: post
title: "Linux Tips(4)"
date: 2016-01-15 18:37:03 +0800
comments: true
categories: Linux
---
### 1. Run ansible commands
Run commands in all hosts:    

```
# ansible all -i inventory.ini -m command -u root --args "uptime"
```

### 2. mesos introduction
[http://www.infoq.com/cn/articles/analyse-mesos-part-02](http://www.infoq.com/cn/articles/analyse-mesos-part-02)    

### 3. Limit ansible run hosts

```
# ansible-playbook -i inventory_mesos_cluster changehostname.yml -u root -k
-vvvv --list-hosts

playbook: changehostname.yml

  play #1 (master1): host count=1
    10.47.58.31

#  ansible-playbook -i
inventory_mesos_cluster changehostname.yml -u root -k -vvvv --limit="master1"

```

### 4. Configure the dhcp configuration of libvirtd
First edit the net configuration:    

```
# virsh net-edit xxxxx
```

![/images/2016_01_16_20_23_08_715x270.jpg](/images/2016_01_16_20_23_08_715x270.jpg)    
### 5. Copy items into clipboard in vim
Hit `Ctrl+v` to visual model, then select the items you want to copy, after select
them, click `"*y` will copy whatever you selected into your clipbard.     

Copy from clipboard---- simply hit `p` in command mode.    

### 6. mesos.cli
When you meet `no module named mesos`, install it via pip:    

```
$ pip install mesos.cli
```

### 7. Startdict In Command Line

```
$ sudo apt-get install -y sdcv
$ wget
https://web.archive.org/web/20140917131745/http://abloz.com/huzheng/stardict-dic/dict.org/stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2
$ sudo mkdir -p /usr/share/stardict/dic/
$ sudo tar xjvf stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2 -C /usr/share/stardict/dic 

```

### 8. Golden Dict
Golden Dict.   

### 9. Latest Info On OpenStack
[https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&mid=404253985&idx=1&sn=0d6c544dfb129e35bde7d19a0de8887b&scene=1&srcid=01267Etq7arAdYaFqbUG5BNa&pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd](https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&mid=404253985&idx=1&sn=0d6c544dfb129e35bde7d19a0de8887b&scene=1&srcid=01267Etq7arAdYaFqbUG5BNa&pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd)    

### 10. Quickly Configure vagrant machine
Via following you could get outside world:     

```
ip route del default gw 10.0.2.2 dev enp0s3
ip a del 192.168.10.199/24 dev enp0s8
ip a add 192.168.10.199/16 dev enp0s8
ip route add default via 192.168.0.79 dev enp0s8
```

### 11. Change the default gateway On CentOS 7
Default gateway should go here:    

```
$ cat /etc/sysconfig/network
# Created by anaconda
GATEWAY=192.168.0.79
```

And remove the origin default gateway by adding following definitions :    

```
$ cat /etc/sysconfig/network-scripts/ifcfg-enp0s3 
# Generated by dracut initrd
NAME="enp0s3"
DEVICE="enp0s3"
BOOTPROTO=dhcp
# This one is not the default gw
DEFROUTE=no
# Do not override the dns
PEERDNS=no
```
Thus the default gateway won't go from enp0s3, but from enp0s8, won't configure the dns
address to 10.0.x.x.    

### 12. On VPNs

```
http://linsir.org/post/how_to_install_IPSec_IKEV2_base_on_strongswan_with_CentOS7
https://quericy.me/blog/512
https://quericy.me/blog/699
http://lifehacker.io/post/108814979111/%E5%9C%A8%E6%90%AC%E7%93%A6%E5%B7%A5%E7%9A%84centos7%E4%B8%8B%E6%90%AD%E5%BB%BAstrongswan%E5%AE%9E%E7%8E%B0%E5%9C%A8ios%E4%B8%8A%E6%8C%89%E9%9C%80%E8%BF%9E%E6%8E%A5vpn
https://raymii.org/s/tutorials/IPSEC_vpn_with_CentOS_7.html
https://linux.cn/article-5938-weibo.html
```

MMC snap-in:    
[https://technet.microsoft.com/en-us/library/cc722035.aspx](https://technet.microsoft.com/en-us/library/cc722035.aspx)    

### 13. Use iptables On CentOS7
Use  following steps for disable firewalld and use iptables.    

```
$ systemctl stop firewalld
$ systemctl mask firewalld
$ yum install iptables-services
$ systemctl enable iptables
$ systemctl start iptables

```

### 14. Quickly Goes kernel configuration
When you want to configure the newer kernel source tree using your old kernel
configuration, simply do following:    

```
# yes "" | make oldconfig
```

### 15. iptables problem
After installing the newest kernel, I cannot use iptables, showing ` can't initialize iptables : table does not exist`.       

Solution: compile the modules again, select nat.     

![/images/2016_01_28_16_05_52_496x361.jpg](/images/2016_01_28_16_05_52_496x361.jpg)    

Selecting from:     
Networking Support    
Network Options     
Network packet filtering framework(Netfilter)    
IP: Netfilter Configuration    


Then you should `make modules_install` under your kernel source building directory.     

### 16. DistCC For Building Kernel DEB
On configurating distcc:    
[http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html](http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html)    

On building Linux kernel deb files:    

[http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/](http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/)     

And:    

[https://help.ubuntu.com/community/Kernel/Compile](https://help.ubuntu.com/community/Kernel/Compile)     

Actual command:    

```
$ time sudo make -j12 CC=distcc
$ sudo MAKEFLAGS="CC=distcc" make-kpkg --rootcmd fakeroot --initrd --append-to-version=-suspend2 kernel-image kernel-headers kernel-source -j16
```

Really takes long time for building the kernel out, but the iptables won't works.    


### 17. dmenu On Ubuntu
dmenu is in the package of suckless-tools.    

```
$ sudo apt-get install suckless-tools
```

### 18. Virtio-GPU How-to
[https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/](https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/)    

### 20. Use Latest Dev Kernel On Fedora
Refers to
[http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories](http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories)     

```
$ curl -s https://repos.fedorapeople.org/repos/thl/kernel-vanilla.repo | sudo tee /etc/yum.repos.d/kernel-vanilla.repo
$ sudo dnf --enablerepo=kernel-vanilla-mainline update
```

Fall back to the stable one:    

```
$ sudo dnf --enablerepo=kernel-vanilla-stable update
```

### 21. Install grub on usb disk/ArchLinux

```
# chattr -i /boot/grub/i386-pc/core.img 
# grub-install --target=i386-pc --recheck --debug --force /dev/sdb
# chattr +i /boot/grub/i386-pc/core.img 
```
### 22. fcitx-gtk3
Since now firefox using gtk3, so if you want to input chinese in firefox, simply install `fcitx-gtk3` then you get fcitx working.     

### 23. Polkit And Virt-manager
Problem:    

```
$ virsh -c qemu:///system
error: failed to connect to the hypervisor
error: authentication failed: no agent is available to authenticate
```

Add the configuration for the polkit and restart the service:    

```
$ sudo vim /etc/polkit-1/rules.d/49-org.libvirt.unix.manager.rules
polkit.addRule(function(action, subject) {
    if (action.id == "org.libvirt.unix.manage" &&
        subject.isInGroup("kvm")) {
            return polkit.Result.YES;
        }
});
```

And also you have to add your current user into the group of `kvm`:    

```
$ sudo usermod -a -G kvm <user name>
```

Restar the polkit service via:    

```
$ sudo systemctl restart polkit.service
```

### 24. Running tasks in byobu
[http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen](http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen)    

### 25. GPU Pass-Through
[http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/](http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/)    

### 26. yaourt build error
Reason: gpg checking error, solution is:    

```
$ proxychains4 gpg --recv-key  79BE3E4300411886
```

### 27. libvirtd and polkit
Bypass the password prompt:    

[https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt](https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt)     


### 28. virgl repository
[https://www.kraxel.org/repos/](https://www.kraxel.org/repos/)    

### 29. pass-through howto
[http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html](http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html)     

### 30. Control the USB port power
[http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux](http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux)     

### 31. On how to reverse usb device
[http://www.linuxjournal.com/article/7353?page=0,0](http://www.linuxjournal.com/article/7353?page=0,0)    
[https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/](https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/)    

### 32. Set/Unset keyboard LED
Turn on/off the Scroll LED of the keyboard(USB):    

```
xset led 3
xset -led 3
```

### 33. USB In a NutShell
[http://www.beyondlogic.org/usbnutshell/usb1.shtml](http://www.beyondlogic.org/usbnutshell/usb1.shtml)    
